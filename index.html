<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>ระบบรายรับรายจ่ายชาวนา</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 700px; margin: auto; background: #f0fdf4; }
    h1, h2 { text-align: center; }
    label, input, select, textarea { display: block; width: 100%; margin-bottom: 10px; }
    button { padding: 10px 15px; background: green; color: white; border: none; cursor: pointer; margin-top: 10px; }
    .status { margin-top: 10px; color: blue; text-align: center; }
    table { width: 100%; margin-top: 20px; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    nav { display: flex; justify-content: space-around; margin-bottom: 20px; }
    nav button { background-color: #008080; }
  </style>
</head>
<body>
  <h1>ระบบบันทึกรายรับรายจ่าย (ชาวนา)</h1>
  <nav>
    <button onclick="switchPage('form')">บันทึกรายการ</button>
    <button onclick="switchPage('dashboard')">Dashboard</button>
  </nav>

  <div id="formPage">
    <label>ประเภท</label>
    <select id="type">
      <option value="income">รายรับ</option>
      <option value="expense">รายจ่าย</option>
    </select>

    <label>จำนวนเงิน (บาท)</label>
    <input type="number" id="amount" required />

    <label>คำอธิบาย</label>
    <textarea id="description" rows="2"></textarea>

    <button onclick="submitData()">บันทึกข้อมูล</button>
    <div class="status" id="status"></div>
  </div>

  <div id="dashboardPage" style="display:none;">
    <h2>Dashboard</h2>
    <table id="summaryTable">
      <thead><tr><th>วันที่</th><th>ประเภท</th><th>จำนวน</th><th>คำอธิบาย</th></tr></thead>
      <tbody id="summaryBody"></tbody>
    </table>
    <div class="status" id="loadStatus">กำลังโหลดข้อมูล...</div>
  </div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbyvvihOdnUK2dNXgrCCqfT-2Oh-7lvRzj0VE2L84CNOGXLHybMhKh6tFqNomPOaDoZI/exec";

    function switchPage(page) {
      document.getElementById("formPage").style.display = page === "form" ? "block" : "none";
      document.getElementById("dashboardPage").style.display = page === "dashboard" ? "block" : "none";
      if (page === "dashboard") loadDashboard();
    }

    function submitData() {
      const type = document.getElementById("type").value;
      const amount = document.getElementById("amount").value;
      const description = document.getElementById("description").value;
      const status = document.getElementById("status");

      fetch(scriptURL, {
        method: 'POST',
        body: JSON.stringify({ type, amount, description }),
        headers: { 'Content-Type': 'application/json' }
      })
      .then(response => response.text())
      .then(result => {
        status.textContent = "บันทึกข้อมูลเรียบร้อย ✅";
        document.getElementById("amount").value = "";
        document.getElementById("description").value = "";
      })
      .catch(error => {
        status.textContent = "เกิดข้อผิดพลาด ❌";
        console.error('Error!', error.message);
      });
    }

    function loadDashboard() {
      const sheetJSONUrl = "https://sheet2api.com/v1/UVLBhmMpSKkZ/farmer-ledger"; // ใช้ Sheets API หรือ Sheet as JSON
      fetch(sheetJSONUrl)
        .then(res => res.json())
        .then(data => {
          const table = document.getElementById("summaryBody");
          table.innerHTML = "";
          data.forEach(row => {
            const tr = document.createElement("tr");
            tr.innerHTML = `<td>${row.date}</td><td>${row.type}</td><td>${row.amount}</td><td>${row.description}</td>`;
            table.appendChild(tr);
          });
          document.getElementById("loadStatus").textContent = "โหลดข้อมูลสำเร็จ ✅";
        })
        .catch(err => {
          document.getElementById("loadStatus").textContent = "โหลดข้อมูลไม่สำเร็จ ❌";
        });
    }
  </script>
</body>
</html>